<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>liblightmodbus: Master device</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">liblightmodbus<span id="projectnumber">&#160;3.0</span>
   </div>
   <div id="projectbrief">A lightweight, header-only, hardware-agnostic Modbus RTU/TCP library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('master.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Master device </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >In order to use slave side functions, make sure to define <code>LIGHTMODBUS_MASTER</code> macro and enable necessary functions (e.g. <code>LIGHTMODBUS_F03M</code>) before including the library. Please also see <a class="el" href="building.html">Building and integrating liblightmodbus</a> for more information.</p>
<h1><a class="anchor" id="master-init"></a>
Master initialization</h1>
<p >Master device state is represented by <a class="el" href="structModbusMaster.html" title="Master device status.">ModbusMaster</a> structure. It must be initialized with <a class="el" href="master_8h.html#af3c4b8930f540697662dfdb0788f38ef" title="Initializes a ModbusMaster struct.">modbusMasterInit()</a> before it is used: </p><div class="fragment"><div class="line"><a class="code hl_struct" href="structModbusMaster.html">ModbusMaster</a> master;</div>
<div class="line"><a class="code hl_struct" href="structModbusErrorInfo.html">ModbusErrorInfo</a> err;</div>
<div class="line">err = <a class="code hl_function" href="master_8h.html#af3c4b8930f540697662dfdb0788f38ef">modbusMasterInit</a>(</div>
<div class="line">    &amp;master,          </div>
<div class="line">    myDataCallback,                  <span class="comment">// Callback for handling incoming data</span></div>
<div class="line">    myExceptionCallback,             <span class="comment">// Exception callback (optional)</span></div>
<div class="line">    <a class="code hl_function" href="base_8h.html#a85c4c4d0226d45b625c75912467aba44">modbusDefaultAllocator</a>,          <span class="comment">// Memory allocator used to allocate request</span></div>
<div class="line">    <a class="code hl_variable" href="master_8h.html#ab7ae0464095b7a5f02a0dcb0643145f8">modbusMasterDefaultFunctions</a>,    <span class="comment">// Set of supported functions</span></div>
<div class="line">    <a class="code hl_variable" href="master_8h.html#abafe1a006897216d68be414d9f8623a7">modbusMasterDefaultFunctionCount</a> <span class="comment">// Number of supported functions</span></div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check for errors</span></div>
<div class="line">assert(<a class="code hl_function" href="base_8h.html#a64880e7075f445881485396f3aa869c5">modbusIsOk</a>(err) &amp;&amp; <span class="stringliteral">&quot;modbusMasterInit() failed&quot;</span>); </div>
<div class="ttc" id="abase_8h_html_a64880e7075f445881485396f3aa869c5"><div class="ttname"><a href="base_8h.html#a64880e7075f445881485396f3aa869c5">modbusIsOk</a></div><div class="ttdeci">static uint8_t modbusIsOk(ModbusErrorInfo err)</div><div class="ttdoc">Checks if ModbusErrorInfo contains an error.</div><div class="ttdef"><b>Definition:</b> base.h:442</div></div>
<div class="ttc" id="abase_8h_html_a85c4c4d0226d45b625c75912467aba44"><div class="ttname"><a href="base_8h.html#a85c4c4d0226d45b625c75912467aba44">modbusDefaultAllocator</a></div><div class="ttdeci">ModbusError modbusDefaultAllocator(ModbusBuffer *buffer, uint16_t size, void *context)</div><div class="ttdoc">The default memory allocator based on realloc()</div><div class="ttdef"><b>Definition:</b> base.impl.h:21</div></div>
<div class="ttc" id="amaster_8h_html_ab7ae0464095b7a5f02a0dcb0643145f8"><div class="ttname"><a href="master_8h.html#ab7ae0464095b7a5f02a0dcb0643145f8">modbusMasterDefaultFunctions</a></div><div class="ttdeci">ModbusMasterFunctionHandler modbusMasterDefaultFunctions[]</div><div class="ttdoc">Default array of supported functions. Length is stored in modbusMasterDefaultFunctionCount.</div><div class="ttdef"><b>Definition:</b> master.impl.h:18</div></div>
<div class="ttc" id="amaster_8h_html_abafe1a006897216d68be414d9f8623a7"><div class="ttname"><a href="master_8h.html#abafe1a006897216d68be414d9f8623a7">modbusMasterDefaultFunctionCount</a></div><div class="ttdeci">const uint8_t modbusMasterDefaultFunctionCount</div><div class="ttdoc">Stores length of modbusMasterDefaultFunctions array.</div><div class="ttdef"><b>Definition:</b> master.impl.h:63</div></div>
<div class="ttc" id="amaster_8h_html_af3c4b8930f540697662dfdb0788f38ef"><div class="ttname"><a href="master_8h.html#af3c4b8930f540697662dfdb0788f38ef">modbusMasterInit</a></div><div class="ttdeci">ModbusErrorInfo modbusMasterInit(ModbusMaster *status, ModbusDataCallback dataCallback, ModbusMasterExceptionCallback exceptionCallback, ModbusAllocator allocator, const ModbusMasterFunctionHandler *functions, uint8_t functionCount)</div><div class="ttdoc">Initializes a ModbusMaster struct.</div><div class="ttdef"><b>Definition:</b> master.impl.h:79</div></div>
<div class="ttc" id="astructModbusErrorInfo_html"><div class="ttname"><a href="structModbusErrorInfo.html">ModbusErrorInfo</a></div><div class="ttdoc">Richer error represenation - source and type of error.</div><div class="ttdef"><b>Definition:</b> base.h:126</div></div>
<div class="ttc" id="astructModbusMaster_html"><div class="ttname"><a href="structModbusMaster.html">ModbusMaster</a></div><div class="ttdoc">Master device status.</div><div class="ttdef"><b>Definition:</b> master.h:73</div></div>
</div><!-- fragment --><p >Similarly to slave, master has two callbacks - data callback and exception callback. The first is used for processing all register data incoming to master, the latter for handling exceptions reported by the slave. These callbacks are described in more detail in <a class="el" href="master.html#master-data-callback">Data callback</a> and <a class="el" href="master.html#master-exception-callback">Exception callback</a>.</p>
<p >Master also relies on a memory allocator - please refer to <a class="el" href="allocators.html">Custom allocators</a> for more details.</p>
<p >The 5th argument determines the set of functions supported by the master device. It should be a pointer to an array of <code><a class="el" href="structModbusMasterFunctionHandler.html" title="Associates Modbus function ID with a pointer to a response parsing function.">ModbusMasterFunctionHandler</a></code> structures which associate function codes with callbacks. The lifetime of this array must not be shorter than the lifetime of the <code><a class="el" href="structModbusMaster.html" title="Master device status.">ModbusMaster</a></code> structure. The last argument must contain that array's length.</p>
<h1><a class="anchor" id="master-data-callback"></a>
Data callback</h1>
<p >The data callback is a function matching <a class="el" href="master_8h.html#a72568d58b84e35534eda87b106b34271">ModbusDataCallback</a>, used to provide data read from the slaves to user.</p>
<p >This function is called from <code>modbusParseResponse*()</code> for every received register/coil/input value. The address of the slave, index of the register, its value and function used to acquire it are provided as an argument of type <code><a class="el" href="structModbusDataCallbackArgs.html" title="Arguments for the data callback.">ModbusDataCallbackArgs</a></code>.</p>
<p >If you're sure that none of the used parsing functions use the data callback, you can pass <code>NULL</code> as the argument to <code><a class="el" href="master_8h.html#af3c4b8930f540697662dfdb0788f38ef" title="Initializes a ModbusMaster struct.">modbusMasterInit()</a></code>. Importantly, all default parsing functions in the library require the data callback to be provided.</p>
<p >The data callback must return a <code>ModbusError</code>. It should always return <code>MODBUS_OK</code>. </p><dl class="section note"><dt>Note</dt><dd>Return values from this callback are ignored. This, however, should not be relied upon and may be subject to change in future versions of the library.</dd></dl>
<p>An example of a simple data callback printing out all received data: </p><div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">    Data callback for printing all incoming data</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><a class="code hl_enumeration" href="base_8h.html#a3e91ea9ea1b4d5927573e6ec1d1cce6e">ModbusError</a> dataCallback(<span class="keyword">const</span> <a class="code hl_struct" href="structModbusMaster.html">ModbusMaster</a> *master, <span class="keyword">const</span> <a class="code hl_struct" href="structModbusDataCallbackArgs.html">ModbusDataCallbackArgs</a> *args)</div>
<div class="line">{</div>
<div class="line">    printf(</div>
<div class="line">        <span class="stringliteral">&quot;Received data:\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\t from: %d\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\t  fun: %d\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\t type: %s\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\t   id: %d\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\tvalue: %d\n&quot;</span>,</div>
<div class="line">        args-&gt;<a class="code hl_variable" href="structModbusDataCallbackArgs.html#afb3c81cbf60b1c461e25bd7a5115b5bd">address</a>,</div>
<div class="line">        args-&gt;<a class="code hl_variable" href="structModbusDataCallbackArgs.html#a164f69c8dc82314a92fbbcfc8fbab7dc">function</a>,</div>
<div class="line">        <a class="code hl_function" href="debug_8h.html#ac91629d4444a397e54ddb36094e94cf6">modbusDataTypeStr</a>(args-&gt;<a class="code hl_variable" href="structModbusDataCallbackArgs.html#ae1743537afa977b2d0301d0cd6d6b155">type</a>), <span class="comment">// Requires LIGHTMODBUS_DEBUG</span></div>
<div class="line">        args-&gt;<a class="code hl_variable" href="structModbusDataCallbackArgs.html#aa74530fdd8af6db1bf86226c61c02235">index</a>,</div>
<div class="line">        args-&gt;<a class="code hl_variable" href="structModbusDataCallbackArgs.html#a698a52a6233be7a94bcea8e707c1e853">value</a></div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Always return MODBUS_OK</span></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="base_8h.html#a3e91ea9ea1b4d5927573e6ec1d1cce6eafbb178df49063323a6dcbf03dd0d88d2">MODBUS_OK</a>;</div>
<div class="line">}</div>
<div class="ttc" id="abase_8h_html_a3e91ea9ea1b4d5927573e6ec1d1cce6e"><div class="ttname"><a href="base_8h.html#a3e91ea9ea1b4d5927573e6ec1d1cce6e">ModbusError</a></div><div class="ttdeci">ModbusError</div><div class="ttdoc">Represtents different kinds of errors.</div><div class="ttdef"><b>Definition:</b> base.h:137</div></div>
<div class="ttc" id="abase_8h_html_a3e91ea9ea1b4d5927573e6ec1d1cce6eafbb178df49063323a6dcbf03dd0d88d2"><div class="ttname"><a href="base_8h.html#a3e91ea9ea1b4d5927573e6ec1d1cce6eafbb178df49063323a6dcbf03dd0d88d2">MODBUS_OK</a></div><div class="ttdeci">@ MODBUS_OK</div><div class="ttdoc">No error.</div><div class="ttdef"><b>Definition:</b> base.h:143</div></div>
<div class="ttc" id="adebug_8h_html_ac91629d4444a397e54ddb36094e94cf6"><div class="ttname"><a href="debug_8h.html#ac91629d4444a397e54ddb36094e94cf6">modbusDataTypeStr</a></div><div class="ttdeci">const char * modbusDataTypeStr(ModbusDataType type)</div><div class="ttdoc">Returns a string containing the name of the ModbusDataType enum value.</div><div class="ttdef"><b>Definition:</b> debug.impl.h:86</div></div>
<div class="ttc" id="astructModbusDataCallbackArgs_html"><div class="ttname"><a href="structModbusDataCallbackArgs.html">ModbusDataCallbackArgs</a></div><div class="ttdoc">Arguments for the data callback.</div><div class="ttdef"><b>Definition:</b> master.h:40</div></div>
<div class="ttc" id="astructModbusDataCallbackArgs_html_a164f69c8dc82314a92fbbcfc8fbab7dc"><div class="ttname"><a href="structModbusDataCallbackArgs.html#a164f69c8dc82314a92fbbcfc8fbab7dc">ModbusDataCallbackArgs::function</a></div><div class="ttdeci">uint8_t function</div><div class="ttdoc">Function that reported this value.</div><div class="ttdef"><b>Definition:</b> master.h:44</div></div>
<div class="ttc" id="astructModbusDataCallbackArgs_html_a698a52a6233be7a94bcea8e707c1e853"><div class="ttname"><a href="structModbusDataCallbackArgs.html#a698a52a6233be7a94bcea8e707c1e853">ModbusDataCallbackArgs::value</a></div><div class="ttdeci">uint16_t value</div><div class="ttdoc">Value of the register.</div><div class="ttdef"><b>Definition:</b> master.h:43</div></div>
<div class="ttc" id="astructModbusDataCallbackArgs_html_aa74530fdd8af6db1bf86226c61c02235"><div class="ttname"><a href="structModbusDataCallbackArgs.html#aa74530fdd8af6db1bf86226c61c02235">ModbusDataCallbackArgs::index</a></div><div class="ttdeci">uint16_t index</div><div class="ttdoc">Index of the register.</div><div class="ttdef"><b>Definition:</b> master.h:42</div></div>
<div class="ttc" id="astructModbusDataCallbackArgs_html_ae1743537afa977b2d0301d0cd6d6b155"><div class="ttname"><a href="structModbusDataCallbackArgs.html#ae1743537afa977b2d0301d0cd6d6b155">ModbusDataCallbackArgs::type</a></div><div class="ttdeci">ModbusDataType type</div><div class="ttdoc">Type of Modbus register.</div><div class="ttdef"><b>Definition:</b> master.h:41</div></div>
<div class="ttc" id="astructModbusDataCallbackArgs_html_afb3c81cbf60b1c461e25bd7a5115b5bd"><div class="ttname"><a href="structModbusDataCallbackArgs.html#afb3c81cbf60b1c461e25bd7a5115b5bd">ModbusDataCallbackArgs::address</a></div><div class="ttdeci">uint8_t address</div><div class="ttdoc">Address of the slave.</div><div class="ttdef"><b>Definition:</b> master.h:45</div></div>
</div><!-- fragment --><h1><a class="anchor" id="master-exception-callback"></a>
Exception callback</h1>
<p >Master exception callback is a function matching <a class="el" href="master_8h.html#af3eef8284352773b30fcfd74a6064b5a">ModbusMasterExceptionCallback</a> called when an exception response frame is parsed by one of the <code>modbusParseResponse*()</code> functions.</p>
<p >When called, the callback is provided with address of the slave that reported the exception, function code of the function that caused it and a Modbus exception code (<a class="el" href="base_8h.html#a0b7f726dfaa2b4cf98aaaed1eb42fa72">ModbusExceptionCode</a>). The callback must return a <code>ModbusError</code> value, which should be <code>MODBUS_OK</code>.</p>
<dl class="section note"><dt>Note</dt><dd>Return values from this callback are ignored. This, however, should not be relied upon and may be subject to change in future versions of the library.</dd></dl>
<p>An example of a simple exception callback printing out all received exceptions: </p><div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">    Exception callback for printing out exceptions on master side</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><a class="code hl_enumeration" href="base_8h.html#a3e91ea9ea1b4d5927573e6ec1d1cce6e">ModbusError</a> masterExceptionCallback(</div>
<div class="line">    <span class="keyword">const</span> <a class="code hl_struct" href="structModbusMaster.html">ModbusMaster</a> *master,</div>
<div class="line">    uint8_t address,</div>
<div class="line">    uint8_t function,</div>
<div class="line">    <a class="code hl_enumeration" href="base_8h.html#a0b7f726dfaa2b4cf98aaaed1eb42fa72">ModbusExceptionCode</a> code)</div>
<div class="line">{</div>
<div class="line">    printf(</div>
<div class="line">        <span class="stringliteral">&quot;Received exception %s (function %d) from slave %d\n&quot;</span>,</div>
<div class="line">        <a class="code hl_function" href="debug_8h.html#af3781bf8d2f5b1c31149d76cdb353e41">modbusExceptionCodeStr</a>(code),</div>
<div class="line">        function,</div>
<div class="line">        address);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Always return MODBUS_OK</span></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="base_8h.html#a3e91ea9ea1b4d5927573e6ec1d1cce6eafbb178df49063323a6dcbf03dd0d88d2">MODBUS_OK</a>;</div>
<div class="line">}</div>
<div class="ttc" id="abase_8h_html_a0b7f726dfaa2b4cf98aaaed1eb42fa72"><div class="ttname"><a href="base_8h.html#a0b7f726dfaa2b4cf98aaaed1eb42fa72">ModbusExceptionCode</a></div><div class="ttdeci">ModbusExceptionCode</div><div class="ttdoc">Represents a Modbus exception code.</div><div class="ttdef"><b>Definition:</b> base.h:230</div></div>
<div class="ttc" id="adebug_8h_html_af3781bf8d2f5b1c31149d76cdb353e41"><div class="ttname"><a href="debug_8h.html#af3781bf8d2f5b1c31149d76cdb353e41">modbusExceptionCodeStr</a></div><div class="ttdeci">const char * modbusExceptionCodeStr(ModbusExceptionCode code)</div><div class="ttdoc">Returns a string containing the name of the ModbusExceptionCode enum value.</div><div class="ttdef"><b>Definition:</b> debug.impl.h:67</div></div>
</div><!-- fragment --><h1><a class="anchor" id="master-requests"></a>
Building requests</h1>
<p >Master side of the library provides a set of functions for building requests. They are named according to the pattern <code>modbusMasterBuildRequest*()</code>. Where <code>*</code> is code of the function followed by the Modbus request format to be generated (PDU, RTU or TCP).</p>
<p >The functions without PDU, RTU or TCP at the end of their name are generic functions responsible for building the request frame and must only be used in between calls to <code>modbusBeginRequest*()</code> and <code>modbusEndRequest*()</code>.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Function code   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Functions    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">01   </td><td class="markdownTableBodyNone">Read multiple coils   </td><td class="markdownTableBodyNone"><a class="el" href="master__func_8h.html#aadb2b7e2d3ee4fbde22cdf076713d75e" title="Read multiple coils - a wrapper for modbusBuildRequest01020304()">modbusBuildRequest01()</a><br  />
<a class="el" href="master__func_8h.html#a036fd7e438c21e4436eb9e1992a64c67" title="Read multiple coils - a wrapper for modbusBuildRequest01020304()">modbusBuildRequest01PDU()</a><br  />
<a class="el" href="master__func_8h.html#acb7c8487c5dfd3e2bde1d2eb4e1c7811" title="Read multiple coils - a wrapper for modbusBuildRequest01020304()">modbusBuildRequest01RTU()</a><br  />
<a class="el" href="master__func_8h.html#a14c8872d550dbbb8761f4a1042fff649" title="Read multiple coils - a wrapper for modbusBuildRequest01020304()">modbusBuildRequest01TCP()</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">02   </td><td class="markdownTableBodyNone">Read multiple discrete inputs   </td><td class="markdownTableBodyNone"><a class="el" href="master__func_8h.html#a2a6452a8200d77483254bef08ee2cf8c" title="Read multiple discrete inputs - a wrapper for modbusBuildRequest01020304()">modbusBuildRequest02()</a><br  />
<a class="el" href="master__func_8h.html#aa4e2b9bc734bcf9cfe11446978ad2749" title="Read multiple discrete inputs - a wrapper for modbusBuildRequest01020304()">modbusBuildRequest02PDU()</a><br  />
<a class="el" href="master__func_8h.html#a7c9e76a1b3413934be7db3ad9a7c4376" title="Read multiple discrete inputs - a wrapper for modbusBuildRequest01020304()">modbusBuildRequest02RTU()</a><br  />
<a class="el" href="master__func_8h.html#ae6a15d65cbc0ce17ce08489d154635d2" title="Read multiple discrete inputs - a wrapper for modbusBuildRequest01020304()">modbusBuildRequest02TCP()</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">03   </td><td class="markdownTableBodyNone">Read multiple holding registers   </td><td class="markdownTableBodyNone"><a class="el" href="master__func_8h.html#a1c7ed51c58b1ef42ee176833c7fd0515" title="Read multiple holding registers - a wrapper for modbusBuildRequest01020304()">modbusBuildRequest03()</a><br  />
<a class="el" href="master__func_8h.html#adf65ea5a34d043faa37140f6a55d89cf" title="Read multiple holding registers - a wrapper for modbusBuildRequest01020304()">modbusBuildRequest03PDU()</a><br  />
<a class="el" href="master__func_8h.html#a981113c60842ea2229c3d3e257121d10" title="Read multiple holding registers - a wrapper for modbusBuildRequest01020304()">modbusBuildRequest03RTU()</a><br  />
<a class="el" href="master__func_8h.html#a761fa44fa5548411b8e0902de3321506" title="Read multiple holding registers - a wrapper for modbusBuildRequest01020304()">modbusBuildRequest03TCP()</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">04   </td><td class="markdownTableBodyNone">Read multiple input registers   </td><td class="markdownTableBodyNone"><a class="el" href="master__func_8h.html#a22bf4541196b3e88c0a86861d334e3b1" title="Read multiple input registers - a wrapper for modbusBuildRequest01020304()">modbusBuildRequest04()</a><br  />
<a class="el" href="master__func_8h.html#a71851993d0a0918462301d9f4d6fe6aa" title="Read multiple input registers - a wrapper for modbusBuildRequest01020304()">modbusBuildRequest04PDU()</a><br  />
<a class="el" href="master__func_8h.html#adb03361e5219534d6f7dc18d787660e6" title="Read multiple input registers - a wrapper for modbusBuildRequest01020304()">modbusBuildRequest04RTU()</a><br  />
<a class="el" href="master__func_8h.html#a35e60f9600850281d13a580eb30950c0" title="Read multiple input registers - a wrapper for modbusBuildRequest01020304()">modbusBuildRequest04TCP()</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">05   </td><td class="markdownTableBodyNone">Write a single coil   </td><td class="markdownTableBodyNone"><a class="el" href="master__func_8h.html#a7151355c8c34af355fd779f88a64e125" title="Write single coil - a wrapper for modbusBuildRequest0506()">modbusBuildRequest05()</a><br  />
<a class="el" href="master__func_8h.html#aa5a433b3e7a48e1f3256e9a7ebc2d5f9" title="Write single coil - a wrapper for modbusBuildRequest0506()">modbusBuildRequest05PDU()</a><br  />
<a class="el" href="master__func_8h.html#a1ad7f539bc45d5d943fb1339c7d1f2bd" title="Write single coil - a wrapper for modbusBuildRequest0506()">modbusBuildRequest05RTU()</a><br  />
<a class="el" href="master__func_8h.html#ad47799443f43ac23050d69dc29b26752" title="Write single coil - a wrapper for modbusBuildRequest0506()">modbusBuildRequest05TCP()</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">06   </td><td class="markdownTableBodyNone">Write a single holding register   </td><td class="markdownTableBodyNone"><a class="el" href="master__func_8h.html#a56779853bdfd2bb75601be746c20eb09" title="Write single holding register - a wrapper for modbusBuildRequest0506()">modbusBuildRequest06()</a><br  />
<a class="el" href="master__func_8h.html#ad75b916525fbf3ba80ae77d1e6acc6d0" title="Write single holding register - a wrapper for modbusBuildRequest0506()">modbusBuildRequest06PDU()</a><br  />
<a class="el" href="master__func_8h.html#a21ea9d0c54ab7551f43934e930a6d39c" title="Write single holding register - a wrapper for modbusBuildRequest0506()">modbusBuildRequest06RTU()</a><br  />
<a class="el" href="master__func_8h.html#a79d1a01f10075df14260d3f781398ffb" title="Write single holding register - a wrapper for modbusBuildRequest0506()">modbusBuildRequest06TCP()</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">15   </td><td class="markdownTableBodyNone">Write multiple coils   </td><td class="markdownTableBodyNone"><a class="el" href="master__func_8h.html#ae9842e659ccd8942905e685923de8916" title="Write multiple coils.">modbusBuildRequest15()</a><br  />
<a class="el" href="master__func_8h.html#aa789e4539bf44290fa66eab485b3a8ed" title="Write multiple coils.">modbusBuildRequest15PDU()</a><br  />
<a class="el" href="master__func_8h.html#a826f619c6a0fcb8647dcc8ec32ea177d" title="Write multiple coils.">modbusBuildRequest15RTU()</a><br  />
<a class="el" href="master__func_8h.html#a7e7feb0b6ddad4c3fee45029c42f8e2c" title="Write multiple coils.">modbusBuildRequest15TCP()</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">16   </td><td class="markdownTableBodyNone">Write multiple holding registers   </td><td class="markdownTableBodyNone"><a class="el" href="master__func_8h.html#aca022c438a427d8f4b03db4427c2b344" title="Write multiple holding registers.">modbusBuildRequest16()</a><br  />
<a class="el" href="master__func_8h.html#a32e386df6141f16eb8e60ea23c2f333e" title="Write multiple holding registers.">modbusBuildRequest16PDU()</a><br  />
<a class="el" href="master__func_8h.html#a99ba6b883a865fc1e099d7c85cfa6dbf" title="Write multiple holding registers.">modbusBuildRequest16RTU()</a><br  />
<a class="el" href="master__func_8h.html#a0f7eb40aface6de3d3048bdfed65b5de" title="Write multiple holding registers.">modbusBuildRequest16TCP()</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">22   </td><td class="markdownTableBodyNone">Mask write register   </td><td class="markdownTableBodyNone"><a class="el" href="master__func_8h.html#a6f2c5d59dee73c80ad54e53cca38aeec" title="Mask write register request.">modbusBuildRequest22()</a><br  />
<a class="el" href="master__func_8h.html#ab1f3aaf911b17aea73957f7f276d8d7e" title="Mask write register request.">modbusBuildRequest22PDU()</a><br  />
<a class="el" href="master__func_8h.html#a1cf59e366f7f160d823b1018fb139d78" title="Mask write register request.">modbusBuildRequest22RTU()</a><br  />
<a class="el" href="master__func_8h.html#a1dd49d9ddf78b43b76ca072a04dc007c" title="Mask write register request.">modbusBuildRequest22TCP()</a>   </td></tr>
</table>
<p >Please see <a class="el" href="master__func_8impl_8h.html">master_func.impl.h</a> for more details.</p>
<p >For instance, a request to read the holding register 17 from slave with address 1 can be built with following code: </p><div class="fragment"><div class="line"><span class="comment">// For Modbus RTU</span></div>
<div class="line"><a class="code hl_struct" href="structModbusErrorInfo.html">ModbusErrorInfo</a> err;</div>
<div class="line">err = <a class="code hl_function" href="master__func_8h.html#a981113c60842ea2229c3d3e257121d10">modbusBuildRequest03RTU</a>(&amp;master, 1, 17, 1);</div>
<div class="line">assert(<a class="code hl_function" href="base_8h.html#a64880e7075f445881485396f3aa869c5">modbusIsOk</a>(err) &amp;&amp; <span class="stringliteral">&quot;modbusBuildRequest03RTU() failed&quot;</span>);</div>
<div class="ttc" id="amaster__func_8h_html_a981113c60842ea2229c3d3e257121d10"><div class="ttname"><a href="master__func_8h.html#a981113c60842ea2229c3d3e257121d10">modbusBuildRequest03RTU</a></div><div class="ttdeci">static ModbusErrorInfo modbusBuildRequest03RTU(ModbusMaster *status, uint8_t address, uint16_t index, uint16_t count)</div><div class="ttdoc">Read multiple holding registers - a wrapper for modbusBuildRequest01020304()</div><div class="ttdef"><b>Definition:</b> master_func.h:239</div></div>
</div><!-- fragment --><p >If the request has been built successfully, it can be accessed via <code><a class="el" href="master_8h.html#a6b738cabc69d94b52e86dfe50ea2972d" title="Returns a pointer to the request generated by the master.">modbusMasterGetRequest()</a></code>, has length of <code><a class="el" href="master_8h.html#a21bae28555e4781f79f2d7e4bf8a5d71" title="Returns the length of the request generated by the master.">modbusMasterGetRequestLength()</a></code> bytes and can be sent to the slave.</p>
<h1><a class="anchor" id="master-response"></a>
Processing responses</h1>
<p >After obtaining the response from the slave, it's time to process it. In order to do that, one of the <code>modbusParseResponse*()</code> functions can be used: </p><div class="fragment"><div class="line"><span class="comment">// For Modbus RTU</span></div>
<div class="line"><a class="code hl_struct" href="structModbusErrorInfo.html">ModbusErrorInfo</a> err;</div>
<div class="line">err = <a class="code hl_function" href="master_8h.html#a151b85c221ae43804856eb92737498e5">modbusParseResponseRTU</a>(</div>
<div class="line">    &amp;master,</div>
<div class="line">    <a class="code hl_function" href="master_8h.html#a6b738cabc69d94b52e86dfe50ea2972d">modbusMasterGetRequest</a>(&amp;master),</div>
<div class="line">    <a class="code hl_function" href="master_8h.html#a21bae28555e4781f79f2d7e4bf8a5d71">modbusMasterGetRequestLength</a>(&amp;master),</div>
<div class="line">    slaveResponseData,</div>
<div class="line">    slaveResponseLength);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Handle serious errors</span></div>
<div class="line"><span class="keywordflow">if</span> (<a class="code hl_function" href="base_8h.html#a84765449265aa5a31877b749f04cb568">modbusGetGeneralError</a>(err))</div>
<div class="line">    handleMasterError(err);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Handle errors related to the structure of the request frame</span></div>
<div class="line"><span class="comment">// If the request produced by modbusBuildRequest*() caused</span></div>
<div class="line"><span class="comment">// you may have found a bug!</span></div>
<div class="line"><span class="keywordflow">if</span> (<a class="code hl_function" href="base_8h.html#a5c6f792a259423b2df55d8d49e91fd06">modbusGetRequestError</a>(err))</div>
<div class="line">    handleRequestError(err);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Handle errors related to the structure of the response frame</span></div>
<div class="line"><span class="comment">// e.g. invalid CRC, frame too short</span></div>
<div class="line"><span class="keywordflow">if</span> (<a class="code hl_function" href="base_8h.html#acbf9b7e6b679be88ce4e10ffb617d3e9">modbusGetResponseError</a>(err))</div>
<div class="line">    handleResponseError(err);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Optionally free the request frame</span></div>
<div class="line"><a class="code hl_function" href="master_8h.html#a040a82085ce05ff95c53d3dca4c3acfd">modbusMasterFreeRequest</a>(&amp;master);</div>
<div class="ttc" id="abase_8h_html_a5c6f792a259423b2df55d8d49e91fd06"><div class="ttname"><a href="base_8h.html#a5c6f792a259423b2df55d8d49e91fd06">modbusGetRequestError</a></div><div class="ttdeci">static ModbusError modbusGetRequestError(ModbusErrorInfo err)</div><div class="ttdoc">Returns request error from ModbusErrorInfo.</div><div class="ttdef"><b>Definition:</b> base.h:462</div></div>
<div class="ttc" id="abase_8h_html_a84765449265aa5a31877b749f04cb568"><div class="ttname"><a href="base_8h.html#a84765449265aa5a31877b749f04cb568">modbusGetGeneralError</a></div><div class="ttdeci">static ModbusError modbusGetGeneralError(ModbusErrorInfo err)</div><div class="ttdoc">Returns general error from ModbusErrorInfo.</div><div class="ttdef"><b>Definition:</b> base.h:452</div></div>
<div class="ttc" id="abase_8h_html_acbf9b7e6b679be88ce4e10ffb617d3e9"><div class="ttname"><a href="base_8h.html#acbf9b7e6b679be88ce4e10ffb617d3e9">modbusGetResponseError</a></div><div class="ttdeci">static ModbusError modbusGetResponseError(ModbusErrorInfo err)</div><div class="ttdoc">Returns response error from ModbusErrorInfo.</div><div class="ttdef"><b>Definition:</b> base.h:472</div></div>
<div class="ttc" id="amaster_8h_html_a040a82085ce05ff95c53d3dca4c3acfd"><div class="ttname"><a href="master_8h.html#a040a82085ce05ff95c53d3dca4c3acfd">modbusMasterFreeRequest</a></div><div class="ttdeci">static void modbusMasterFreeRequest(ModbusMaster *status)</div><div class="ttdoc">Frees memory allocated for master's request frame.</div><div class="ttdef"><b>Definition:</b> master.h:172</div></div>
<div class="ttc" id="amaster_8h_html_a151b85c221ae43804856eb92737498e5"><div class="ttname"><a href="master_8h.html#a151b85c221ae43804856eb92737498e5">modbusParseResponseRTU</a></div><div class="ttdeci">ModbusErrorInfo modbusParseResponseRTU(ModbusMaster *status, const uint8_t *request, uint16_t requestLength, const uint8_t *response, uint16_t responseLength)</div><div class="ttdoc">Parses a Modbus RTU slave response.</div><div class="ttdef"><b>Definition:</b> master.impl.h:260</div></div>
<div class="ttc" id="amaster_8h_html_a21bae28555e4781f79f2d7e4bf8a5d71"><div class="ttname"><a href="master_8h.html#a21bae28555e4781f79f2d7e4bf8a5d71">modbusMasterGetRequestLength</a></div><div class="ttdeci">static uint16_t modbusMasterGetRequestLength(const ModbusMaster *status)</div><div class="ttdoc">Returns the length of the request generated by the master.</div><div class="ttdef"><b>Definition:</b> master.h:136</div></div>
<div class="ttc" id="amaster_8h_html_a6b738cabc69d94b52e86dfe50ea2972d"><div class="ttname"><a href="master_8h.html#a6b738cabc69d94b52e86dfe50ea2972d">modbusMasterGetRequest</a></div><div class="ttdeci">static const uint8_t * modbusMasterGetRequest(const ModbusMaster *status)</div><div class="ttdoc">Returns a pointer to the request generated by the master.</div><div class="ttdef"><b>Definition:</b> master.h:128</div></div>
</div><!-- fragment --><h1><a class="anchor" id="master-cleanup"></a>
Master cleanup</h1>
<p >When you're done using an instance of <code><a class="el" href="structModbusMaster.html" title="Master device status.">ModbusMaster</a></code>, you can destroy it using <code><a class="el" href="master_8h.html#a5fe38fae0f89de04fa616d105f660d25" title="Deinitializes a ModbusMaster struct.">modbusMasterDestroy()</a></code>.</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="master_8h.html#a5fe38fae0f89de04fa616d105f660d25">modbusMasterDestroy</a>(&amp;master);</div>
<div class="ttc" id="amaster_8h_html_a5fe38fae0f89de04fa616d105f660d25"><div class="ttname"><a href="master_8h.html#a5fe38fae0f89de04fa616d105f660d25">modbusMasterDestroy</a></div><div class="ttdeci">void modbusMasterDestroy(ModbusMaster *status)</div><div class="ttdoc">Deinitializes a ModbusMaster struct.</div><div class="ttdef"><b>Definition:</b> master.impl.h:102</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
